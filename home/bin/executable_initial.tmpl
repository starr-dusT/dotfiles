#!/usr/bin/env sh
set -e
echo -e "Starting initial setup for Fedora..."

# Install ansible and run playbook
sudo dnf -y update && sudo dnf install -y ansible

# Install ansible extensions
ansible-galaxy install -r {{ .chezmoi.workingTree }}/provision/requirements.yml

# Goto playbook and run it
cd {{ .chezmoi.workingTree }}/provision
ansible-playbook setup.yml -i hosts --ask-become-pass

# Return to where you were
cd -

read -p "Reboot? " -n 1 -r
echo    # (optional) move to a new line
if [[ ! $REPLY =~ ^[Yy]$ ]]
then
    exit 1
fi

sudo reboot
